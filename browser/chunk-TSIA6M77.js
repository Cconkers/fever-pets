import{g as f,h as I,p as v,r as b}from"./chunk-NSOEABXR.js";import{T as h,Y as o,k as P,ma as s,o as d,x as u}from"./chunk-DAHMJGAY.js";import{a as m,b as S}from"./chunk-7CGTOI24.js";var p=class{compute(t){let e=t.weight/(t.height*t.length);return e<2||e>5?"unhealthy":e<3?"very healthy":"healthy"}},c=class extends p{compute(t){return t.number_of_lives===1?"unhealthy":super.compute(t)}},n=class r{static getStrategy(t){switch(t.kind){case"cat":return new c;default:return new p}}static withHealth(t){let e=t.weight/(t.height*t.length),i=this.getStrategy(t).compute(t);return S(m({},t),{healthScore:e,healthTier:i})}static HEALTH_CLASS_MAP={healthy:"health--good","very healthy":"health--very-good",unhealthy:"health--bad"};static getPetHealthClass(t){return r.HEALTH_CLASS_MAP[t]??""}};var a={BASE_URL:"https://my-json-server.typicode.com/Feverup/fever_pets_data",ENDPOINTS:{PETS:"pets"},PAGINATION:{DEFAULT_PAGE:1,DEFAULT_PAGE_SIZE:10}};var g=class r{baseUrl=a.BASE_URL;http=o(I);getPets(t,e){let i=new f().set("_page",e.page).set("_limit",e.perPage);return t?.sortValue&&t?.sortDirection&&(i=i.set("_sort",t.sortValue).set("_order",t.sortDirection)),this.http.get(`${this.baseUrl}/${a.ENDPOINTS.PETS}`,{params:i,observe:"response"}).pipe(d(l=>{let T=Number(l.headers.get("X-Total-Count"))||0;return{pets:(l.body??[]).map(D=>n.withHealth(D)),total:T}}),u(l=>(console.error("Error fetching pets",l),P({pets:[],total:0}))))}getPetDetail(t){return this.http.get(`${this.baseUrl}/${a.ENDPOINTS.PETS}/${t}`).pipe(d(e=>n.withHealth(e)),u(e=>(console.error("Error fetching pet detail",e),P(null))))}static \u0275fac=function(e){return new(e||r)};static \u0275prov=h({token:r,factory:r.\u0275fac,providedIn:"root"})};var N="petPagination",A="petDetailKey",E=class r{apiPets=o(g);storageSafe=o(b);router=o(v);isLoadingPets=s(!1);pets=s([]);petIdSelected=s(Number(this.router.url.split("/").pop()));petDetail=s(null);sortPets=s(null);paginatedPets=s(JSON.parse(this.storageSafe.getItem(N)??"null")??{page:a.PAGINATION.DEFAULT_PAGE,perPage:a.PAGINATION.DEFAULT_PAGE_SIZE});petsTotal=s(0);updateSort(t,e){this.sortPets.set({sortValue:t,sortDirection:e}),t===null||e===null?localStorage.removeItem("petSort"):localStorage.setItem("petSort",JSON.stringify({sortValue:t,sortDirection:e})),this.loadPets()}updatePagination(t,e){let i={page:t+1,perPage:e};this.paginatedPets.set(i),this.storageSafe.setItem(N,JSON.stringify(i)),this.loadPets()}getSortLocalStorage(){let t=this.storageSafe.getItem("petSort");return t?JSON.parse(t):null}loadPets(){this.isLoadingPets.set(!0);let t=this.getSortLocalStorage();this.apiPets.getPets(t,this.paginatedPets()).subscribe({next:e=>{this.petsTotal.set(e.total),this.pets.set(e.pets),this.isLoadingPets.set(!1)},error:e=>{console.error("Error loading pets",e),this.isLoadingPets.set(!1)}})}updatePetDetail(t){this.petIdSelected.set(t),this.storageSafe.setItem(A,this.petIdSelected().toString()),this.loadPetDetail()}loadPetDetail(){this.isLoadingPets.set(!0);let t=this.router.url.split("/").pop();if(t&&!isNaN(+t))this.petIdSelected.set(+t);else{let e=this.storageSafe.getItem(A);e?this.petIdSelected.set(+e):(console.error("No pet id found in storage and url"),this.router.navigate(["/pets"]))}this.apiPets.getPetDetail(this.petIdSelected()).subscribe({next:e=>{e?(this.petDetail.set(e),this.isLoadingPets.set(!1),this.router.navigate(["/pets",e.id])):this.router.navigate(["/pets"])},error:e=>{console.error("Error loading pet detail",e),this.isLoadingPets.set(!1)}})}static \u0275fac=function(e){return new(e||r)};static \u0275prov=h({token:r,factory:r.\u0275fac,providedIn:"root"})};export{n as a,E as b};
